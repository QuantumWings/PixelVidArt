<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PixelVidArt</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>PixelVidArt</h1>
  </header>
  <main>
    <div class="layout-container">
      <section class="controls">
        <div class="upload-control">
          <label for="videoUpload">上傳檔案:</label>
          <input type="file" id="videoUpload" accept="video/*">
        </div>
        <div class="slider-group" style="flex-direction: row; align-items: center;">
          <button id="dotToggleBtn" class="icon-btn" title="切換點顯示">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="4" fill="#fff"/>
            </svg>
          </button>
          <div class="slider-control shape-dropdown" style="width: 90px; margin: 0 0.5rem;">
            <label for="shapeSelect" style="color:#fff;">點形狀:</label>
            <select id="shapeSelect">
              <option value="circle">圓形</option>
              <option value="square">方形</option>
              <option value="hexagon">六邊形</option>
              <option value="heart">愛心</option>
              <option value="star">星形</option>
              <option value="polygon">多邊形</option>
            </select>
          </div>
          <div class="slider-control" style="flex:1;">
            <label for="dotSize">點尺寸: <span id="dotSizeValue">5</span>px</label>
            <input type="range" id="dotSize" min="1" max="50" value="5">
          </div>
        </div>
        <div class="slider-group" style="flex-direction: row; align-items: center;">
          <button id="connectionToggleBtn" class="icon-btn" title="切換連線效果">
            <svg id="connectionIcon" width="24" height="24" viewBox="0 0 24 24">
              <line x1="4" y1="12" x2="20" y2="12" stroke="#aaa" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <div class="slider-control" style="flex:1;">
            <label for="lineComplexity">線複雜度: <span id="lineComplexityValue">1</span></label>
            <input type="range" id="lineComplexity" min="1" max="10" value="1" style="width: 100%;">
          </div>
          <div class="slider-control" style="flex:1;">
            <label for="lineThickness">線寬: <span id="lineThicknessValue">1</span>px</label>
            <input type="range" id="lineThickness" min="1" max="10" value="1" style="width: 100%;">
          </div>
          <div class="slider-control" style="flex:1;">
            <label for="lineStyleSelect">線樣式:</label>
            <select id="lineStyleSelect">
              <option value="curve" selected>曲線</option>
              <option value="straight">直線</option>
              <option value="zigzag">鋸齒</option>
              <option value="wave">波浪</option>
              <option value="dotted">點線</option>
              <option value="spiral">螺旋</option>
              <option value="dashed">虛線</option>
              <option value="bounce">彈跳</option>
              <option value="squiggly">曲折</option>
            </select>
          </div>
        </div>
        <div class="slider-control">
          <label for="thresholdSlider">閥值: <span id="thresholdValue">128</span></label>
          <input type="range" id="thresholdSlider" min="0" max="255" value="128">
        </div>
        <div class="slider-control">
          <label for="playbackRateSlider">播放速度: <span id="playbackRateValue">1.0</span>x</label>
          <input type="range" id="playbackRateSlider" min="0.25" max="2" step="0.05" value="1">
        </div>
        <div class="neon-controls">
          <button id="neonToggleBtn" class="control-btn" title="切換霓虹效果">
            <svg id="neonIcon" width="24" height="24" viewBox="0 0 24 24">
              <rect x="4" y="4" width="16" height="16" fill="none" stroke="#fff" stroke-width="2"/>
              <line x1="4" y1="4" x2="20" y2="20" stroke="#fff" stroke-width="2"/>
            </svg>
            霓虹
          </button>
          <div class="slider-control" style="flex:1; min-width: 200px;">
            <label for="glowSize">霓虹大小: <span id="glowSizeValue">20</span></label>
            <input type="range" id="glowSize" min="0" max="50" value="20" style="width: 100%;">
          </div>
        </div>
        <div class="color-buttons" style="display: flex; gap: 0.75rem; justify-content: center;">
          <button id="dotColorBtn" class="control-btn" title="調整點顏色" style="width: 125px;">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" fill="none" stroke="#fff" stroke-width="2"/>
              <circle cx="12" cy="12" r="4" fill="#ff4081"/>
            </svg>
            點顏色
          </button>
          <input type="color" id="dotColorPicker" style="display: none;" value="#000000">
  
          <button id="lineColorBtn" class="control-btn" title="調整連線顏色" style="width: 125px;">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <line x1="4" y1="20" x2="20" y2="4" stroke="#fff" stroke-width="2"/>
              <line x1="4" y1="4" x2="20" y2="20" stroke="#fff" stroke-width="2"/>
            </svg>
            連線顏色
          </button>
          <input type="color" id="lineColorPicker" style="display: none;" value="#000000">
  
          <button id="neonColorBtn" class="control-btn" title="調整霓虹顏色" style="width: 125px;">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" fill="none" stroke="#fff" stroke-width="2"/>
              <circle id="neonColorPreview" cx="12" cy="12" r="4" fill="#00ffff"/>
            </svg>
            霓虹顏色
          </button>
          <input type="color" id="neonColorPicker" style="display: none;" value="#00ffff">
          <button id="backgroundColorBtn" class="control-btn" title="調整背景顏色" style="width: 125px;">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <rect x="4" y="4" width="16" height="16" fill="#fff" stroke="#fff" stroke-width="2"/>
            </svg>
            背景顏色
          </button>
          <input type="color" id="backgroundColorPicker" style="display: none;" value="#ffffff">
        </div>
        <div class="extra-controls" style="display: flex; gap: 0.75rem; justify-content: center; flex-wrap: wrap;">
          <button id="intensityToggleBtn" class="control-btn" title="切換強度模式">
            <svg id="intensityIcon" width="24" height="24" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" fill="none" stroke="#fff" stroke-width="2"/>
              <line x1="8" y1="12" x2="16" y2="12" stroke="#fff" stroke-width="2"/>
            </svg>
            強度模式
          </button>
          <button id="backgroundToggleBtn" class="control-btn" title="切換反相背景" style="width: 125px;">
            <svg width="24" height="24" viewBox="0 0 24 24" id="bgToggleIcon">
              <rect x="3" y="3" width="18" height="18" fill="#fff" stroke="#000" stroke-width="2"/>
            </svg>
            反相背景
          </button>
          <button id="dynamicToggleBtn" class="control-btn" title="切換動態粒子" style="width: 125px;">
            <svg id="dynamicIcon" width="24" height="24" viewBox="0 0 24 24">
              <path fill="none" stroke="#fff" stroke-width="2" d="M13 2v7h7l-9 13v-9H4l9-11z"/>
            </svg>
            動態
          </button>
        </div>
        <div class="sound-group" style="display: flex; align-items: center; gap: 0.5rem;">
          <button id="soundBtn" class="icon-btn" title="切換音效">
            <svg id="soundIcon" width="24" height="24" viewBox="0 0 24 24">
              <path fill="#fff" d="M3 9v6h4l5 5V4l-5 5H3z"/>
              <line x1="2" y1="2" x2="22" y2="22" stroke="#fff" stroke-width="2"/>
            </svg>
          </button>
          <label for="volumeSlider" style="margin: 0;">音量:</label>
          <input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="1">
        </div>
        <div class="extra-controls">
          <button id="snapshotBtn" title="擷取畫面">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path fill="#fff" d="M21 5h-3.17l-1.84-2H7.99l-1.84 2H3v14h18V5zM12 17a5 5 0 1 1 0-10 5 5 0 0 1 0 10z"/>
            </svg>
            擷圖
          </button>
          <button id="fullscreenBtn" title="切換全螢幕">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path fill="#fff" d="M7 14H5v5h5v-2H7v-3zm0-4h2V7h3V5H7v5zm10 8h-3v2h5v-5h-2v3zm-3-10V5h5v5h-2V7h-3z"/>
            </svg>
            全螢幕
          </button>
          <button id="resetBtn" title="重設所有設定">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path fill="#fff" d="M12 6V3L8 7l4 4V8c3.31 0 6 2.69 6 6 0 1.11-.36 2.14-.97 3L19 18.03C20.23 16.73 21 14.47 21 12c0-4.97-4.03-9-9-9zm-6 6c0-1.11.36-2.14.97-3L5 5.97C3.77 7.27 3 9.53 3 12c0 4.97 4.03 9 9 9v3l4-4-4-4v3c-3.31 0-6-2.69-6-6z"/>
            </svg>
            重設
          </button>
          <button id="helpBtn" title="說明">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" fill="#fff" opacity="0.3"/>
              <path fill="#fff" d="M12 6a3 3 0 0 1 3 3c0 1.5-1 2-1.5 2-.5.5-.5 1-.5 1l-1 1h-1v-1c0-.5 0-1 1-1 .5 0 1-.5 1-1a1 1 0 1 0-2 0H9a3 3 0 1 1 3-3zM11 17h2v2h-2z"/>
            </svg>
            說明
          </button>
        </div>
        <div class="recording-controls" style="display: flex; flex-direction: column; gap: 0.5rem;">
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <label for="resolutionSelect">儲存解析度:</label>
            <select id="resolutionSelect">
              <option value="original">原始</option>
              <option value="480p">480p</option>
              <option value="720p">720p</option>
              <option value="1080p">1080p</option>
              <option value="4K">4K</option>
            </select>
            <label for="includeAudioCheck" style="margin-left: 1rem;">包含音效:</label>
            <input type="checkbox" id="includeAudioCheck" checked>
          </div>
          <button id="saveVideoBtn" title="影片轉換並儲存點陣特效影片">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <rect x="4" y="4" width="16" height="16" fill="none" stroke="#fff" stroke-width="2"/>
              <polygon points="10,8 16,12 10,16" fill="#fff"/>
            </svg>
            儲存影片
          </button>
          <progress id="conversionProgress" value="0" max="100" style="width:100%; display:none;"></progress>
        </div>
      </section>
      <section class="video-section">
        <div class="video-container" id="videoContainer">
          <video id="sourceVideo" muted playsinline style="display: none;"></video>
          <canvas id="effectCanvas"></canvas>
          <div id="videoPlaceholder">尚未載入影片</div>
          <div class="button-group" style="display: flex; align-items: center; gap: 0.5rem;">
            <div class="time-slider-wrapper" style="flex:2; display: flex; align-items: center;">
              <label for="timeSlider" style="display:none;">影片時間</label>
              <input type="range" id="timeSlider" min="0" max="0" step="0.1" value="0" style="flex:1;">
              <span id="timeSliderValue">0:00</span>
            </div>
            <button id="pausePlayBtn" title="播放/暫停影片">
              <svg id="pausePlayIcon" width="10" height="10" viewBox="0 0 24 24">
                <polygon points="8,5 19,12 8,19" fill="#fff"/>
              </svg>
            </button>
            <button id="replayBtn" title="重播影片">
              <svg width="10" height="10" viewBox="0 0 24 24">
                <path fill="#fff" d="M12,5V1L7,6l5,5V7c3.86,0,7,3.14,7,7s-3.14,7-7,7s-7-3.14-7-7H3c0,5.04,4.05,9,9,9s9-3.96,9-9S17.04,5,12,5z"/>
              </svg>
            </button>
            <button id="autoReplayBtn" title="自動重播影片">
              <svg width="10" height="10" viewBox="0 0 24 24">
                <path fill="#fff" d="M12 5V1L7 6l5,5V7c3.86,0 7,3.14,7,7 0 1.68-.57 3.23-1.52 4.5l1.46 1.46C19.07 18.07 20 15.63 20 13c0-4.42-3.58-8-8-8zm-1 14c-3.31 0-6-2.69-6-6H3l4-4 4 4H7c0 2.21 1.79 4 4 4v2z"/>
              </svg>
            </button>
            <button id="toggleOriginalBtn" title="切換原始影片">
              <svg width="10" height="10" viewBox="0 0 24 24">
                <path fill="#fff" d="M4 6h16v12H4z" opacity="0.3"/>
                <path fill="#fff" d="M2 4v16h20V4H2zm18 14H4V6h16v12z"/>
              </svg>
            </button>
          </div>
        </div>
      </section>
    </div>
  </main>
  <div id="helpModal" class="modal">
    <div class="modal-content">
      <span id="modalClose" class="close">&times;</span>
      <h2>PixelVidArt 說明</h2>
      <p>
        本工具可將上傳的影片轉換成獨特的點陣圖藝術效果，並提供多項控制選項以調整視覺效果。以下說明介紹各項功能操作方式：
      </p>
      <ul>
        <li>
          <strong>上傳檔案：</strong>
          <br>點擊「上傳檔案」按鈕，選擇影片檔案，上傳後影片會自動播放並以點陣效果呈現。
        </li>
        <li>
          <strong>點形狀：</strong>
          <br>利用「點形狀」下拉選單選擇點的形狀（圓形、方形、六邊形、心形、星形、多邊形）。
        </li>
        <li>
          <strong>點大小與顯示：</strong>
          <br>使用「點大小」滑桿調整點的尺寸，並可點擊圖示切換是否顯示點。
        </li>
        <li>
          <strong>連線：</strong>
          <br>點擊「連線」按鈕可啟用或關閉點與點之間的連線，並可透過「連線複雜度」、「連線粗細」及「連線風格」調整連線效果。
        </li>
        <li>
          <strong>閾值：</strong>
          <br>利用「閾值」滑桿設定亮度門檻，低於該值的區域將以點陣效果呈現。
        </li>
        <li>
          <strong>播放速度：</strong>
          <br>透過「播放速度」滑桿控制影片播放速度。
        </li>
        <li>
          <strong>霓虹效果與霓虹大小：</strong>
          <br>點擊「霓虹」按鈕切換霓虹效果，並使用「霓虹大小」滑桿調整霓虹效果的強度（同時影響點和連線）。
        </li>
        <li>
          <strong>顏色調整：</strong>
          <br>點擊「點顏色」、「連線顏色」、「霓虹顏色」或「背景顏色」按鈕，即可調整相對應的顏色；再次點擊同一按鈕則會關閉色盤視窗。
        </li>
        <li>
          <strong>強度模式：</strong>
          <br>開啟這個模式會呈現亮暗點大小動態效果。
        </li>
        <li>
          <strong>動態粒子：</strong>
          <br>點擊「動態」按鈕可切換動態模式，使點根據影片亮度隨機移動。
        </li>
        <li>
          <strong>反相背景：</strong>
          <br>透過「反相背景」按鈕，在黑白背景之間切換。圖示及文字會反映目前狀態。
        </li>
        <li>
          <strong>音量與靜音：</strong>
          <br>使用旁邊的滑桿調整音量，並可點擊音訊圖示切換靜音。
        </li>
        <li>
          <strong>快照：</strong>
          <br>點擊「快照」按鈕，即可儲存當前點陣效果為 PNG 圖片。
        </li>
        <li>
          <strong>全螢幕：</strong>
          <br>點擊「全螢幕」按鈕，以獲得沉浸式的觀看體驗。
        </li>
        <li>
          <strong>重設：</strong>
          <br>點擊「重設」按鈕，即可將所有設定（包含點大小、連線屬性、顏色及播放速度）恢復預設值。
        </li>
        <li>
          <strong>影片播放控制：</strong>
          <br>
          - 「影片時間」滑桿可讓您跳到影片中的特定時間並從該時刻播放。<br>
          - 「播放/暫停」按鈕用以切換影片播放與暫停；<br>
          - 「重新播放」及「自動重播」按鈕分別用於重啟播放或自動循環播放；<br>
          - 「切換原始影片顯示」按鈕用於顯示或隱藏原始影片畫面。
        </li>
        <li>
          <strong>錄製與儲存影片：</strong>
          <br>從「儲存解析度」下拉選單選擇解析度，並選擇是否包含音訊，點擊「下載影片」將轉檔後的點陣效果影片下載至本機，轉檔進度會透過進度條顯示。
        </li>
      </ul>
      <p>
        請嘗試每種功能以創造出令人驚豔的點陣動態藝術！
      </p>
    </div>
  </div>
  <script src="script.js" type="module"></script>
</body>
</html>
